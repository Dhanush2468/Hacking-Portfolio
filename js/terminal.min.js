var Terminal = function (options) {
  var self = this;
  this.typingSpeed = 100;
  this.lineCount = 0;
  this.pause = 1000;

  if (!options.container || !options.commands) {
    console.warn("Terminal: Missing required container");
  }

  for (var key in options) {
    this[key] = options[key];
  }

  var s = document.createElement("style");
  s.innerHTML = `
		.slick-terminal {
			background: #000;
			height: 300px;
			width: 400px;
			padding: 15px;
			font-family: 'Arial';
			font-size: 14px;
		}
		.slick-terminal-line {
			position: relative;
			overflow: auto;
			margin-bottom: 2px;
		}
		.slick-terminal-caret {
			vertical-align: middle;
			color: #fff;
			margin-right: 10px;
		}
		.slick-terminal-cursor {
			vertical-align: middle;
			display: inline-block;
			width: 8px;
			height: 16px;
			background: #fff;
			opacity: 1;
		}
		.slick-terminal-blink {
			animation-name: blink;
			animation-duration: 1.2s;
			animation-iteration-count: infinite;
		}
		.slick-terminal-text {
			vertical-align: middle;
			color: #fff;
		}

		@keyframes blink {
			0% {opacity: 1}
			60% {opacity: 1}
			80% {opacity: 0}
		}
	`;
  document.head.appendChild(s);

  this.newLine = function () {
    var command = self.commands[self.lineCount];
    var tl = document.createElement("div");
    tl.classList.add("slick-terminal-line");
    tl.innerHTML =
      '<span class="slick-terminal-caret">></span>' +
      '<span class="slick-terminal-text"></span>';
    self.container.appendChild(tl);

    if (self.lineBegin) {
      self.lineBegin();
    }

    var terminalText = tl.querySelector(".slick-terminal-text");

    var cursor = document.createElement("span");
    cursor.classList = "slick-terminal-cursor slick-terminal-blink";
    tl.appendChild(cursor);

    function nextTerminalLine() {
      self.lineCount++;

      if (self.commands[self.lineCount]) {
        if (cursor) {
          tl.removeChild(cursor);
        }

        self.newLine();
      } else if (self.loop) {
        if (cursor) {
          tl.removeChild(cursor);
        }

        self.lineCount = 0;
        self.newLine();
      } else if (self.done) {
        self.done();
      }
    }

    setTimeout(function () {
      if (command.typing) {
        cursor.classList.remove("slick-terminal-blink");
        var commandTextArray = command.text.split("");
        var i = 0;
        var typingInterval = setInterval(function () {
          terminalText.innerHTML += commandTextArray[i];
          i++;

          if (i === commandTextArray.length) {
            clearInterval(typingInterval);
            cursor.classList.add("slick-terminal-blink");
            nextTerminalLine();
          }
        }, self.typingSpeed);
      } else {
        terminalText.innerHTML += command.text;
        nextTerminalLine();
      }
    }, self.pause);
  };

  self.newLine();
};
